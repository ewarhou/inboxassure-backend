# InboxAssure Backend API Documentation

Base URL: http://inboxassure-backend.imnodev.com/api

## Bison Analytics Endpoints

### 1. Bison Dashboard Summary

Retrieves summary metrics for the dashboard per Bison organization including account stats and email delivery predictions.

**Endpoint:** `/analytics/dashboard/summary-bison`  
**Method:** GET  
**Authentication:** Bearer Token  

**Response:**
```json
[
  {
    "organization_id": "123",
    "organization_name": "Karpos",
    "checked_accounts": 160,
    "at_risk_accounts": 40,
    "protected_accounts": 120,
    "spam_emails_count": 1000,
    "inbox_emails_count": 3000,
    "spam_emails_percentage": 25.0,
    "inbox_emails_percentage": 75.0,
    "overall_deliverability": 85.5,
    "last_check_date": "2024-03-15T10:30:45.123456"
  }
]
```

**Response Fields:**
- `organization_id`: Bison organization ID
- `organization_name`: Bison workspace name
- `checked_accounts`: Number of accounts that exist in both Bison and reports
- `at_risk_accounts`: Number of accounts at risk
- `protected_accounts`: Number of protected accounts
- `spam_emails_count`: Estimated number of emails going to spam based on sending limit
- `inbox_emails_count`: Estimated number of emails going to inbox based on sending limit
- `spam_emails_percentage`: Percentage of emails going to spam
- `inbox_emails_percentage`: Percentage of emails going to inbox
- `overall_deliverability`: Overall deliverability score
- `last_check_date`: ISO formatted date of the last check (empty string if no check)

### 2. Bison Sending Power

Get daily sending power (good accounts × sending limit) per Bison workspace within a date range.

**Endpoint:** `/analytics/dashboard/sending-power-bison`  
**Method:** GET  
**Authentication:** Bearer Token  

**Query Parameters:**
- `start_date` (optional): Start date in YYYY-MM-DD format. Defaults to 30 days ago.
- `end_date` (optional): End date in YYYY-MM-DD format. Defaults to current date.

**Response:**
```json
{
  "data": [
    {
      "date": "2024-03-15",
      "workspace_name": "Karpos",
      "sending_power": 3000
    },
    {
      "date": "2024-03-14",
      "workspace_name": "Karpos",
      "sending_power": 2800
    }
  ]
}
```

**Response Fields:**
- `date`: The date for which the sending power is calculated
- `workspace_name`: Name of the Bison workspace
- `sending_power`: Total sending power (good accounts × sending limit)

### 3. Bison Provider Performance

Get performance metrics per provider for Bison accounts including daily aggregated scores and sending power.

**Endpoint:** `/analytics/dashboard/provider-performance-bison`  
**Method:** GET  
**Authentication:** Bearer Token  

**Query Parameters:**
- `start_date` (optional): Start date in YYYY-MM-DD format. Defaults to 30 days ago.
- `end_date` (optional): End date in YYYY-MM-DD format. Defaults to current date.

**Response:**
```json
{
  "data": [
    {
      "organization": "Karpos",
      "provider": "Gmail",
      "start_date": "2024-02-15",
      "end_date": "2024-03-15",
      "total_accounts": 85,
      "reply_rate": null,
      "bounce_rate": null,
      "google_score": 0.92,
      "outlook_score": 0.88,
      "overall_score": 0.90,
      "sending_power": 2125
    },
    {
      "organization": "Karpos",
      "provider": "Yahoo",
      "start_date": "2024-02-15",
      "end_date": "2024-03-15",
      "total_accounts": 35,
      "reply_rate": null,
      "bounce_rate": null,
      "google_score": 0.85,
      "outlook_score": 0.79,
      "overall_score": 0.82,
      "sending_power": 875
    }
  ]
}
```

**Response Fields:**
- `organization`: Name of the Bison organization/workspace
- `provider`: Email provider name (Gmail, Yahoo, etc.)
- `start_date`: Start date of the analysis period
- `end_date`: End date of the analysis period
- `total_accounts`: Total number of accounts for this provider
- `reply_rate`: Reply rate (currently null, reserved for future use)
- `bounce_rate`: Bounce rate (currently null, reserved for future use)
- `google_score`: Average Google deliverability score (0-1)
- `outlook_score`: Average Outlook deliverability score (0-1)
- `overall_score`: Average of Google and Outlook scores
- `sending_power`: Total sending power for this provider (good accounts × sending limit)

## Implementation Notes

1. All Bison endpoints fetch data from the Bison API and deduplicate accounts by email to handle potential duplicates.
2. Data is processed in chunks to avoid SQL parameter limits.
3. Provider tags are identified by the prefix "p." in the tag name.
4. Scores for Bison are in the range 0-1, unlike Instantly which uses 0-4.
5. The endpoints handle pagination internally and return complete results.

## Spamcheck Endpoints

### 1. Get Bison Accounts List

Retrieves a paginated list of Bison email accounts with their latest check results.

**Endpoint:** `/spamcheck/accounts-bison`  
**Method:** GET  
**Authentication:** Bearer Token  

**Query Parameters:**
- `search` (optional): Filter accounts by email content
- `status` (optional): Filter by status (all, Inboxing, Resting)
- `workspace` (optional): Filter by workspace name
- `filter` (optional): Special filter (at-risk, protected)
- `page` (optional): Page number (default: 1)
- `per_page` (optional): Items per page (default: 25)

**Response:**
```json
{
  "data": [
    {
      "email": "test@example.com",
      "domain": "example.com",
      "sends_per_day": 25,
      "google_score": 0.75,
      "outlook_score": 0.5,
      "status": "Inboxing",
      "workspace": "Karpos",
      "last_check": {
        "id": "550e8400-e29b-41d4-a716-446655440000",
        "date": "2024-03-15T10:30:45.123456"
      },
      "reports_link": "https://example.com/report/123"
    }
  ],
  "meta": {
    "total": 150,
    "page": 1,
    "per_page": 25,
    "total_pages": 6
  }
}
```

**Response Fields:**
- `data`: Array of account objects
  - `email`: Email address
  - `domain`: Domain part of the email
  - `sends_per_day`: Daily sending limit
  - `google_score`: Google deliverability score (0-1)
  - `outlook_score`: Outlook deliverability score (0-1)
  - `status`: Account status (Inboxing or Resting)
  - `workspace`: Bison workspace name
  - `last_check`: Information about the last check
    - `id`: Check ID
    - `date`: ISO formatted date of the last check
  - `reports_link`: Link to the detailed report
- `meta`: Pagination metadata
  - `total`: Total number of accounts
  - `page`: Current page number
  - `per_page`: Items per page
  - `total_pages`: Total number of pages
